# Apache 站点配置文件 - JIUHUAN.LOCAL 域
# 保存到 /etc/apache2/sites-available/jiuhuan.conf

<VirtualHost *:80>
    ServerName your-app.jiuhuan.local
    # 或者使用 IP 地址
    # ServerName 10.0.0.xxx

    # 启用代理
    ProxyPreserveHost On
    ProxyRequests Off

    # Kerberos 认证 - 只对自动登录接口启用
    <Location /api/auth/auto-login>
        AuthType GSSAPI
        AuthName "Windows Domain Authentication"
        GssapiCredStore keytab:/etc/apache2/keytab/http.keytab
        GssapiLocalName On
        Require valid-user

        # 将认证后的用户名传递给后端
        RequestHeader set X-Remote-User "%{REMOTE_USER}e" env=REMOTE_USER
    </Location>

    # API 反向代理到 Node.js 后端
    ProxyPass /api http://localhost:3001/api
    ProxyPassReverse /api http://localhost:3001/api

    # 日志
    ErrorLog ${APACHE_LOG_DIR}/jiuhuan_error.log
    CustomLog ${APACHE_LOG_DIR}/jiuhuan_access.log combined
</VirtualHost>

